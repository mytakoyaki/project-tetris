# ADR-013: スコア履歴の保存制限（最新10件+最高記録）

## ステータス
承認済み

## 日付
2024-12-25

## 決定者
プロジェクトチーム

## 技術的決定
スコア履歴は最新10件と最高記録のみを保存し、それ以外は自動削除する。

## 背景
Tetrisゲームでは、ユーザーが頻繁にプレイするため、スコア履歴が大量に蓄積される可能性がある。データベース容量・パフォーマンス・コストを考慮し、保存する履歴を制限する必要がある。

## 検討された選択肢

### 選択肢1: 全履歴保存
- **メリット**: 完全なプレイ履歴、詳細な統計分析が可能
- **デメリット**: データベース容量の急激な増加、パフォーマンス低下、コスト増加、プライバシーリスク

### 選択肢2: 最新N件+最高記録保存（採用）
- **メリット**: データベース容量を制御可能、パフォーマンス維持、コスト削減、ユーザーにとって重要な情報を保持
- **デメリット**: 古い履歴の損失、詳細な統計分析が制限される

### 選択肢3: 期間限定保存（例：1年分）
- **メリット**: 一定期間の履歴を保持、容量制御が可能
- **デメリット**: 実装が複雑、期間設定の根拠が不明確

## 決定理由
1. **データベース容量の制御**: 無限に増加する履歴を防ぎ、コストを抑制
2. **パフォーマンスの維持**: 大量データによるクエリ速度の低下を防止
3. **ユーザー価値の最大化**: 最新の成績と最高記録という、ユーザーにとって最も重要な情報を保持
4. **プライバシーの保護**: 必要最小限のデータ保存によるプライバシーリスクの軽減
5. **運用コストの削減**: ストレージ・バックアップ・メンテナンスコストの抑制

## 保存対象
- **最新10件**: 直近のプレイ結果（スコア、レベル、ライン数、日時等）
- **最高記録**: 各ゲームモードでの最高スコア・最高レベル・最高ライン数
- **統計情報**: 総プレイ回数、平均スコア、実績進捗等の集計値

## 削除対象
- 最新10件を超える古いスコア記録
- 最高記録を更新した古い記録

## 影響
- ユーザーの詳細なプレイ履歴は失われる
- 統計分析の精度が制限される
- データベース設計がシンプルになる
- バックアップ・復旧の負荷が軽減される

## 実装方針
- スコア保存時に古い記録の自動削除ロジックを実装
- 最高記録の更新ロジックを実装
- 統計情報の集計・更新ロジックを実装
- ユーザーへの説明（履歴制限について）を提供 