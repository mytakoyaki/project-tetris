# ADR-019: プライベートルーム優先実装

## ステータス
承認済み

## 日付
2024-12-25

## 決定者
プロジェクトチーム

## 技術的決定
オンライン対戦機能の実装では、プライベートルーム機能を優先的に実装し、その後パブリックマッチング機能を実装する。

## 背景
オンライン対戦機能の実装において、プライベートルーム（フレンド対戦）とパブリックマッチング（自動マッチング）の両方が必要となるが、実装の優先順位を決定する必要がある。

## 検討された選択肢

### 選択肢1: パブリックマッチング優先
- **メリット**: より多くのユーザーが対戦可能、マッチングシステムの早期検証
- **デメリット**: 複雑なマッチングアルゴリズム、レーティングシステムの実装が必要

### 選択肢2: プライベートルーム優先（採用）
- **メリット**: 実装が比較的シンプル、フレンド機能との連携、段階的な機能拡張
- **デメリット**: 初期段階での対戦相手が限定的

## 決定理由
1. **実装の簡素化**: プライベートルームはマッチングアルゴリズムが不要
2. **段階的な開発**: 基盤機能から段階的に拡張
3. **フレンド機能との連携**: 既存のフレンド機能との統合が容易
4. **テストの容易さ**: フレンド同士でのテストが容易
5. **ユーザー体験**: 知り合いとの対戦から始めることで心理的ハードルが低い

## 実装順序

### Phase 1: プライベートルーム基盤
- **ルーム作成**: フレンド同士でのルーム作成
- **ルーム参加**: 招待されたルームへの参加
- **基本的な対戦**: 1対1対戦の基本機能
- **チャット機能**: 基本的なチャット

### Phase 2: フレンド機能強化
- **フレンド管理**: フレンド追加・削除・管理
- **オンライン状態**: フレンドのオンライン状態表示
- **招待システム**: フレンドへの対戦招待

### Phase 3: パブリックマッチング
- **レーティングシステム**: ELOレーティングの実装
- **マッチングアルゴリズム**: 段階的拡大マッチング
- **対戦履歴**: パブリック対戦の履歴管理

## プライベートルームの詳細

### ルーム機能
- **ルーム作成**: 作成者がルームを作成
- **ルーム参加**: 招待されたユーザーが参加
- **ルーム設定**: ゲームモード・ルール設定
- **ルーム状態**: 待機中・対戦中・終了

### 招待システム
- **フレンド招待**: フレンドリストからの招待
- **招待通知**: リアルタイムでの招待通知
- **招待承認**: 招待の承認・拒否

### セキュリティ
- **認証**: ログインユーザーのみ参加可能
- **権限管理**: ルーム作成者の管理権限
- **不正対策**: 基本的な不正検出

## 影響
- 初期段階での対戦機能が限定される
- フレンド機能の実装が必須となる
- パブリックマッチングの実装が後回しになる
- 段階的な機能拡張が可能

## 実装方針
- WebSocket/Socket.ioを使用したリアルタイム通信
- フレンド機能との統合
- シンプルなルーム管理システム
- 将来的なパブリックマッチングへの拡張を考慮した設計
- ユーザー体験を重視したUI/UX設計 