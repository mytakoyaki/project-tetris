# Rust移行 Phase3 SRS・スピン判定 差分調査・実装方針ログ（2024-06-27）

## 公式SRS仕様と現実装の主な差分
- 回転中心・キックテーブルが公式と異なる場合あり（特にI/Oミノ）
- テトリミノ形状・回転ごとのブロック配置が公式とズレている場合あり
- SRS回転・壁蹴り処理が一部簡略化・未対応
- T-Spin判定の中心・角・wallkick定義が公式と異なる場合あり
- テスト網羅性が不十分（全ミノ種・全回転パターン・壁際/床際/ブロック隣接時の挙動）

## 正しい実装手順（TTCガイドライン準拠）
1. 公式SRSテーブル・回転中心の定義（全ミノ種・全回転パターン）
2. テトリミノ形状・回転ごとのブロック配置テーブルの定義
3. SRS回転処理の公式準拠実装（kick offset順試行・wallkick情報返却）
4. fix_tetrominoで4マスすべてをフィールドに埋め込む
5. T-Spin判定ロジックの公式準拠化（中心・角・wallkick・Mini分岐）
6. 全ミノ種・全回転パターンのテストケース追加

## 今後の方針
- 公式SRS/T-Spin仕様を厳密に再現する設計・実装・テストを推進
- JS/Rustともに公式仕様との差分を意識し、段階的に修正・移植
- 参考: [Tetris Guideline SRS](https://tetris.wiki/SRS), [T-Spin判定仕様](https://tetris.wiki/T-Spin)

## Phase3 最終まとめ

- 公式TTC準拠のSRS（Super Rotation System）・スピン判定（T-Spin, S/Z-Spin, I-Spin, J/L-Spin）をRustで厳密に実装
- WASMバインディングを通じてJS/TS側から公式判定を利用できるようにした
- 公式仕様に準拠したテストケース（T-Spin 3角埋まり＋wallkick必須）をRustで作成し、全てパスすることを確認
- SRS回転失敗時は「現状維持」とする公式仕様も実装・検証済み
- 実装の詳細は `src/lib.rs` の `attempt_srs_rotation` 関数・スピン判定各関数・テスト参照

### 公式仕様との比較
- SRS回転・キックテーブル・スピン判定条件はTTCガイドライン完全準拠
- テストも公式のT-Spin判定条件（3角埋まり＋wallkick）を満たす状況でのみ成功
- 回転失敗時は現状維持（上にずらす等はしない）

### 今後の展望
- WASM経由でJS/TS側のUI・スコア・エフェクト・実績連携を本格運用
- Phase4以降はAPI/DB/認証などフルスタック化やUI統合へ 